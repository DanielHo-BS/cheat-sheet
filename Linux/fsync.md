# Introduction
延遲寫（delayed write）:傳統的UNIX實現在核心中設有緩衝區快取記憶體或頁面快取記憶體，大多數磁碟I/O都通過緩衝進行。

為了保證磁碟上實際檔案系統與緩衝區快取記憶體中內容的一致性，UNIX系統提供了sync、fsync和fdatasync三個函式。

# sync
sync函式只是將所有修改過的塊緩衝區排入寫佇列，然後就返回，它並不等待實際寫磁碟操作結束。

# fsync
fsync函式只對由檔案描述符filedes指定的單一檔案起作用，並且等待寫磁碟操作結束，然後返回。

fsync可用於資料庫這樣的應用程式，這種應用程式需要確保將修改過的塊立即寫到磁碟上。

# fdatasync
fdatasync函式類似於fsync，但它隻影響檔案的資料部分。而除資料外，fsync還會同步更新檔案的屬性。

# fflush
標準IO函式（如fread，fwrite等）會在記憶體中建立緩衝，該函式重新整理記憶體緩衝，將內容寫入核心緩衝，要想將其真正寫入磁碟，還需要呼叫fsync。

# Summary
1. 是對所有的緩衝區發出寫硬碟的命令，應該使用sync函式
2. 要把一個已經開啟的檔案所做的修改提交到硬碟，應呼叫fsync函式。
3. 針對一個已經開啟的檔案流操作，則應該首先呼叫fsync函式把修改同步到核心緩衝區，然後再呼叫fsync把修改真正的同步到硬碟。